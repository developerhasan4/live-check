<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PREMIUM CRICHD | 4K STREAMZ</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #0a0e17;
            --secondary-bg: #141a26;
            --tertiary-bg: #1e2638;
            --primary-text: #f0f4ff;
            --secondary-text: #a3b3d3;
            --accent-color: #4a6cf7;
            --accent-hover: #5d7dff;
            --border-color: #2a3449;
            --danger-color: #dc3545;
            --font-family: 'Segoe UI', 'Poppins', -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            --transition-speed: 0.3s;
            --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--primary-bg); color: var(--primary-text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--secondary-bg); }
        ::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 10px; }
        header { background-color: rgba(20, 26, 38, 0.7); backdrop-filter: blur(10px); padding: 12px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); z-index: 100; }
        .logo-container { display: flex; align-items: center; gap: 12px; }
        .logo-img { width: 36px; height: 36px; border-radius: 8px; }
        header h1 { margin: 0; font-size: 1.6em; font-weight: 700; background: linear-gradient(90deg, var(--accent-color), #8a9eff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-actions { display: flex; align-items: center; gap: 16px; }
        .header-btn { background-color: var(--accent-color); color: white; padding: 10px 18px; border-radius: var(--border-radius); font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; transition: background-color var(--transition-speed) ease; }
        .header-btn.secondary { background-color: var(--tertiary-bg); }
        .header-btn:hover { background-color: var(--accent-hover); }
        .main-content { display: flex; flex: 1; overflow: hidden; }
        #video-container { flex-grow: 1; background-color: #000; display: flex; align-items: center; justify-content: center; position: relative; }
        #player { width: 100%; height: 100%; background-color: #000;}
        .player-placeholder { text-align: center; color: var(--secondary-text); padding: 30px; max-width: 500px; position: absolute; z-index: 1; pointer-events: none; }
        .player-placeholder img { width: 140px; opacity: 0.8; margin-bottom: 25px; }
        .player-placeholder h2 { margin-bottom: 15px; font-size: 2em; color: var(--primary-text); }
        .player-placeholder .btn-group { pointer-events: all; }
        #channel-list-container { flex-basis: 380px; flex-shrink: 0; background-color: var(--secondary-bg); display: flex; flex-direction: column; border-left: 1px solid var(--border-color); z-index: 10; transition: transform var(--transition-speed) ease; }
        .sidebar-header { padding: 16px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background-color: var(--secondary-bg); }
        .sidebar-header .close-btn { background: none; border: none; color: var(--secondary-text); font-size: 1.2em; cursor: pointer; }
        .sidebar-title { font-size: 1.2em; font-weight: 600; }
        .channel-count { background-color: var(--accent-color); color: white; padding: 3px 8px; border-radius: 20px; font-size: 0.8em; }
        .search-bar { padding: 16px; border-bottom: 1px solid var(--border-color); position: relative; }
        .search-bar .search-icon { position: absolute; top: 50%; left: 30px; transform: translateY(-50%); color: var(--secondary-text); }
        #search-input { width: 100%; padding: 12px 12px 12px 40px; background-color: var(--tertiary-bg); border: 1px solid var(--border-color); color: var(--primary-text); border-radius: var(--border-radius); font-size: 1em; }
        .channel-categories { padding: 12px 16px; border-bottom: 1px solid var(--border-color); display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; background-color: var(--secondary-bg); }
        .channel-categories::-webkit-scrollbar { display: none; }
        .category-btn { background-color: var(--tertiary-bg); color: var(--secondary-text); padding: 6px 14px; border-radius: 20px; font-size: 0.85em; border: none; cursor: pointer; white-space: nowrap; }
        .category-btn.active { background-color: var(--accent-color); color: white; }
        #channels { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        .channel-item { display: flex; align-items: center; padding: 14px 20px; cursor: pointer; border-bottom: 1px solid var(--border-color); }
        .channel-item.active { background: linear-gradient(90deg, rgba(74, 108, 247, 0.2), transparent); border-left: 4px solid var(--accent-color); padding-left: 16px; }
        .channel-logo { width: 42px; height: 42px; margin-right: 15px; border-radius: 50%; object-fit: cover; }
        .channel-info { flex-grow: 1; overflow: hidden; }
        .channel-name, .channel-category { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .channel-name { font-weight: 600; }
        .channel-category { font-size: 0.8em; color: var(--secondary-text); }
        .channel-item.active .channel-name { color: var(--accent-hover); }
        .channel-favorite { background: none; border: none; color: var(--secondary-text); font-size: 1.2em; cursor: pointer; }
        .channel-favorite i.active { color: #ffc107; }
        .sidebar-footer { padding: 16px; text-align: center; font-size: 0.85em; color: var(--secondary-text); background-color: var(--tertiary-bg); border-top: 1px solid var(--border-color); }
        .toast-notification { position: fixed; bottom: 30px; right: 30px; background-color: rgba(20, 26, 38, 0.8); backdrop-filter: blur(5px); border-radius: var(--border-radius); padding: 20px; z-index: 2000; width: 90%; max-width: 450px; transform: translateX(calc(100% + 30px)); opacity: 0; transition: all 0.4s ease; border-left: 4px solid var(--accent-color); display: flex; align-items: center; gap: 15px;}
        .toast-notification.active { transform: translateY(0); opacity: 1; }
        .toast-icon img { width: 50px; height: 50px; border-radius: 10px; }
        .toast-content h3 { margin: 0 0 5px 0; font-size: 1.1em; color: var(--primary-text); }
        .toast-content p { margin: 0 0 10px 0; color: var(--secondary-text); font-size: 0.9em; }
        .toast-close { background: none; border: none; color: var(--secondary-text); font-size: 1.2em; cursor: pointer; position: absolute; top: 10px; right: 10px; }
        .btn { padding: 10px 20px; border-radius: var(--border-radius); font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; cursor: pointer; border: none; }
        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-secondary { background-color: var(--tertiary-bg); color: var(--primary-text); }
        .spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; border: 4px solid rgba(255, 255, 255, 0.1); border-radius: 50%; border-top-color: var(--accent-color); animation: spin 1s linear infinite; z-index: 10; display: none; }
        @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }
        .hidden { display: none !important; }

        @media (max-width: 768px) {
            #channel-list-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 60vh; z-index: 200; transform: translateY(100%); border-left: none; border-top: 1px solid var(--border-color); }
            #channel-list-container.visible { transform: translateY(0); }
            .main-content { flex-direction: column; height: calc(100vh - 61px); }
            #video-container { height: 40vh; flex-grow: 0; }
            .toast-notification { bottom: 20px; right: 20px; width: calc(100% - 40px); }
        }
        @media (max-width: 480px) {
             header h1 { font-size: 1.2em; }
            .header-btn span { display: none; }
            .header-btn i { margin-right: 0; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="https://i.postimg.cc/QdcPXf3m/20250702-155459.png" alt="CRICHD Logo" class="logo-img">
            <h1>CRICHD BY 4K STREAMZ</h1>
        </div>
        <div class="header-actions">
            <button id="toggle-channels-btn" class="header-btn secondary"><i class="fas fa-list"></i><span>Channels</span></button>
            <a href="https://github.com/nightbirdscompany/4kstreamzdata/raw/refs/heads/main/UpdateApk/4K%20Streamz%20v2.5.apk" class="header-btn" target="_blank"><i class="fas fa-download"></i><span>Download App</span></a>
        </div>
    </header>

    <main class="main-content">
        <div id="video-container">
            <video id="player" controls></video>
            <div class="player-placeholder" id="player-placeholder">
                <img src="https://i.postimg.cc/QdcPXf3m/20250702-155459.png" alt="CRICHD Logo">
                <h2>Premium Streaming Experience</h2>
                <div class="btn-group">
                    <button class="btn btn-primary" id="explore-btn"><i class="fas fa-compass"></i> Explore Channels</button>
                </div>
            </div>
            <div class="spinner" id="loading-spinner"></div>
        </div>
        <aside id="channel-list-container"></aside>
    </main>
    
    <div class="toast-notification" id="app-toast">
        <div class="toast-icon">
            <img src="https://i.postimg.cc/QdcPXf3m/20250702-155459.png" alt="App Icon">
        </div>
        <div class="toast-content">
            <h3>Enhanced Experience Available</h3>
            <p>Get our official app for more content.</p>
            <a href="https://github.com/nightbirdscompany/4kstreamzdata/raw/refs/heads/main/UpdateApk/4K%20Streamz%20v2.5.apk" class="btn btn-primary" target="_blank">Download</a>
        </div>
        <button class="toast-close" id="toast-close-btn" aria-label="Close">&times;</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const originalApiUrl = 'https://tinyurl.com/4kstreamzappcrichd';
            
            const videoElement = document.getElementById('player');
            const channelListContainer = document.getElementById('channel-list-container');
            const playerPlaceholder = document.getElementById('player-placeholder');
            const loadingSpinner = document.getElementById('loading-spinner');
            const toggleChannelsBtn = document.getElementById('toggle-channels-btn');
            const exploreBtn = document.getElementById('explore-btn');
            const appToast = document.getElementById('app-toast');
            const closeToastBtn = document.getElementById('toast-close-btn');

            let hls;
            let allChannels = [];
            let currentChannel = null;
            let favorites = JSON.parse(localStorage.getItem('crichd_favorites')) || [];

            async function fetchWithFallback(url) {
                try {
                    const directResponse = await fetch(url, { cache: 'no-cache' });
                    if (directResponse.ok) return directResponse.json();
                } catch (e) {
                    console.warn("Direct fetch failed, trying proxy.", e);
                }
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const proxiedApiUrl = `${proxyUrl}${encodeURIComponent(url)}`;
                const proxyResponse = await fetch(proxiedApiUrl);
                if (!proxyResponse.ok) throw new Error(`Both direct and proxy fetches failed.`);
                return proxyResponse.json();
            }

            async function fetchChannels() {
                loadingSpinner.style.display = 'block';
                try {
                    const data = await fetchWithFallback(originalApiUrl);
                    allChannels = data.map(channel => ({ ...channel, isFavorite: favorites.includes(channel.name) }));
                    buildSidebar();
                    checkUrlForChannel();
                } catch (error) {
                    console.error("Fetch Error:", error);
                    channelListContainer.innerHTML = `<p style="padding: 20px; text-align: center; color: var(--danger-color);">Failed to load channel list. Please check your network connection.</p>`;
                } finally {
                    loadingSpinner.style.display = 'none';
                }
            }

            function playChannel(channel) {
                loadingSpinner.style.display = 'block';
                playerPlaceholder.classList.add('hidden');
                currentChannel = channel;
                updateActiveChannel();

                if (hls) hls.destroy();
                
                if (Hls.isSupported()) {
                    hls = new Hls({
                        xhrSetup: (xhr) => {
                            if (channel.referer) xhr.setRequestHeader('Referer', channel.referer);
                            if (channel.origin) xhr.setRequestHeader('Origin', channel.origin);
                        }
                    });
                    hls.loadSource(channel.link);
                    hls.attachMedia(videoElement);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => { videoElement.play(); loadingSpinner.style.display = 'none'; });
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            console.error('HLS Error:', data.details);
                            showToast(`Playback Error: ${data.details}. Stream may be offline or geo-restricted.`);
                            loadingSpinner.style.display = 'none';
                        }
                    });
                } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                    videoElement.src = channel.link;
                    videoElement.addEventListener('canplay', () => { videoElement.play(); loadingSpinner.style.display = 'none'; });
                }
                document.title = `${channel.name} | PREMIUM CRICHD`;
            }

            function buildSidebar() {
                const sidebarHeader = document.createElement('div');
                sidebarHeader.className = 'sidebar-header';
                sidebarHeader.innerHTML = `<div class="sidebar-title">Channels <span class="channel-count">0</span></div><button class="close-btn" aria-label="Close"><i class="fas fa-times"></i></button>`;
                
                const searchBar = document.createElement('div');
                searchBar.className = 'search-bar';
                searchBar.innerHTML = `<span class="search-icon"><i class="fas fa-search"></i></span><input type="text" id="search-input" placeholder="Search channels...">`;
                
                const categoriesEl = document.createElement('div');
                categoriesEl.className = 'channel-categories';
                
                const channelsEl = document.createElement('ul');
                channelsEl.id = 'channels';

                const sidebarFooter = document.createElement('div');
                sidebarFooter.className = 'sidebar-footer';
                sidebarFooter.innerHTML = '<span>Playlist by ABU SAEED X NOOB</span>';

                channelListContainer.append(sidebarHeader, searchBar, categoriesEl, channelsEl, sidebarFooter);

                sidebarHeader.querySelector('.close-btn').addEventListener('click', () => channelListContainer.classList.remove('visible'));
                searchBar.querySelector('#search-input').addEventListener('input', filterAndDisplayChannels);

                populateCategories();
                filterAndDisplayChannels();
            }
            
            function filterAndDisplayChannels() {
                const channelsEl = document.getElementById('channels');
                const searchInput = document.getElementById('search-input');
                const activeCategory = channelListContainer.querySelector('.category-btn.active')?.dataset.category || 'All';
                const searchTerm = searchInput.value.toLowerCase();
                let filtered = allChannels;

                if (activeCategory === 'Favorites') filtered = allChannels.filter(c => c.isFavorite);
                else if (activeCategory !== 'All') filtered = allChannels.filter(c => c.category === activeCategory);
                if (searchTerm) filtered = filtered.filter(c => c.name.toLowerCase().includes(searchTerm));
                
                channelsEl.innerHTML = '';
                if (filtered.length === 0) {
                    channelsEl.innerHTML = '<li style="padding: 20px; text-align: center;">No channels found.</li>';
                } else {
                    filtered.forEach(channel => {
                        const li = document.createElement('li');
                        li.className = 'channel-item';
                        li.dataset.channelId = channel.name;
                        li.innerHTML = `<img src="${channel.logo}" alt="" class="channel-logo" onerror="this.src='https://i.postimg.cc/QdcPXf3m/20250702-155459.png';"><div class="channel-info"><div class="channel-name">${channel.name}</div><div class="channel-category">${channel.category || ''}</div></div><button class="channel-favorite"><i class="fas fa-star ${channel.isFavorite ? 'active' : ''}"></i></button>`;
                        li.addEventListener('click', () => playChannel(channel));
                        li.querySelector('.channel-favorite').addEventListener('click', e => { e.stopPropagation(); toggleFavorite(channel); });
                        channelsEl.appendChild(li);
                    });
                }
                channelListContainer.querySelector('.channel-count').textContent = filtered.length;
                updateActiveChannel();
            }

            function populateCategories() {
                const categoriesEl = channelListContainer.querySelector('.channel-categories');
                const categories = ['All', 'Favorites', ...new Set(allChannels.map(c => c.category).filter(Boolean))];
                categoriesEl.innerHTML = '';
                categories.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = `category-btn ${cat === 'All' ? 'active' : ''}`;
                    btn.dataset.category = cat;
                    btn.textContent = cat;
                    btn.addEventListener('click', () => {
                        categoriesEl.querySelector('.active')?.classList.remove('active');
                        btn.classList.add('active');
                        filterAndDisplayChannels();
                    });
                    categoriesEl.appendChild(btn);
                });
            }
            
            function toggleFavorite(channel) {
                const index = favorites.indexOf(channel.name);
                if (index > -1) { favorites.splice(index, 1); channel.isFavorite = false; } 
                else { favorites.push(channel.name); channel.isFavorite = true; }
                localStorage.setItem('crichd_favorites', JSON.stringify(favorites));
                filterAndDisplayChannels();
            }

            function updateActiveChannel() {
                document.querySelectorAll('.channel-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.channelId === currentChannel?.name);
                });
            }

            function checkUrlForChannel() {
                const channelName = decodeURIComponent(window.location.hash.slice(1));
                const channelToPlay = allChannels.find(c => c.name === channelName);
                if (channelToPlay) playChannel(channelToPlay);
            }
            
            function showToast(message, type = 'error', duration = 5000) {
                const existingToast = document.querySelector('.toast-notification.alert');
                if (existingToast) existingToast.remove();
                
                const toast = document.createElement('div');
                toast.className = 'toast-notification alert';
                toast.style.borderLeftColor = 'var(--danger-color)';
                toast.innerHTML = `<p style="margin:0; color:var(--primary-text);">${message}</p>`;
                document.body.appendChild(toast);
                requestAnimationFrame(() => toast.classList.add('active'));
                setTimeout(() => {
                    toast.classList.remove('active');
                    toast.addEventListener('transitionend', () => toast.remove());
                }, duration);
            }
            
            let toastTimeout;
            function showAppToast() {
                if (appToast.classList.contains('active')) return;
                appToast.classList.add('active');
                toastTimeout = setTimeout(hideAppToast, 15000);
            }
            function hideAppToast() {
                clearTimeout(toastTimeout);
                appToast.classList.remove('active');
            }

            toggleChannelsBtn.addEventListener('click', () => channelListContainer.classList.toggle('visible'));
            exploreBtn.addEventListener('click', () => channelListContainer.classList.toggle('visible'));
            closeToastBtn.addEventListener('click', hideAppToast);
            
            fetchChannels();
            setTimeout(showAppToast, 10000);
            setInterval(showAppToast, 300000);
        });
    </script>

</body>
</html>
